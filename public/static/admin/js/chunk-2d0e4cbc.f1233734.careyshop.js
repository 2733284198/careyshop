(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e4cbc"],{"926c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cs-p"},[a("el-form",{attrs:{inline:!0,size:"small"}},[t.auth.info?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-warning-outline",disabled:t.loading},on:{click:t.handleInfo}},[t._v("购物卡信息")])],1):t._e(),t.auth.enable||t.auth.disable?a("el-form-item",[a("el-button-group",[t.auth.enable?a("el-button",{attrs:{icon:"el-icon-check",disabled:t.loading},on:{click:function(e){return t.handleInvalid(null,1,!0)}}},[t._v("启用")]):t._e(),t.auth.disable?a("el-button",{attrs:{icon:"el-icon-close",disabled:t.loading},on:{click:function(e){return t.handleInvalid(null,0,!0)}}},[t._v("禁用")]):t._e()],1)],1):t._e(),a("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:t.$route.path}})],1),a("el-table",{attrs:{data:t.currentTableData,"highlight-current-row":!0},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"卡号",prop:"number","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.remark?a("el-tooltip",{attrs:{content:"备注："+e.row.remark,placement:"top-start"}},[a("i",{staticClass:"el-icon-tickets cs-pr-5"})]):t._e(),a("span",[t._v(t._s(e.row.number))])]}}])}),a("el-table-column",{attrs:{label:"卡密",prop:"password","min-width":"130"}}),a("el-table-column",{attrs:{label:"可用余额",prop:"money"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("getNumber")(e.row.money))+" ")]}}])}),a("el-table-column",{attrs:{label:"是否激活",align:"center",prop:"is_active"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"mini",effect:"plain",type:t.activeMap[e.row.is_active].type}},[t._v(" "+t._s(t.activeMap[e.row.is_active].text)+" ")])]}}])}),a("el-table-column",{attrs:{label:"激活账号",prop:"get_user.username"}}),a("el-table-column",{attrs:{label:"激活日期",align:"center",prop:"active_time",width:"160"}}),a("el-table-column",{attrs:{label:"状态",align:"center",prop:"is_invalid"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{style:t.auth.enable||t.auth.disable?"cursor: pointer;":"",attrs:{size:"mini",type:t.invalidMap[e.row.is_invalid].type,effect:t.auth.enable||t.auth.disable?"light":"plain"},nativeOn:{click:function(a){return t.handleInvalid(e.$index)}}},[t._v(" "+t._s(t.invalidMap[e.row.is_invalid].text)+" ")])]}}])})],1),a("el-dialog",{attrs:{title:"购物卡信息",visible:t.infoVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(e){t.infoVisible=e}}},[t.cardData?a("el-form",{staticStyle:{"margin-top":"-25px"},attrs:{"label-width":"90px","label-position":"left"}},[a("cs-print",{ref:"print"},[a("el-form-item",{attrs:{label:"名称："}},[a("span",[t._v(t._s(t.cardData.name))])]),a("el-form-item",{attrs:{label:"描述："}},[a("span",[t._v(t._s(t.cardData.description||"-"))])]),a("el-form-item",{attrs:{label:"面额："}},[a("span",[t._v(t._s(t._f("getNumber")(t.cardData.money)))])]),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发放数："}},[a("span",[t._v(t._s(t.cardData.give_num))])])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"激活数："}},[a("span",[t._v(t._s(t.cardData.active_num))])])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"创建时间："}},[a("span",[t._v(t._s(t.cardData.create_time))])])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"截止日期："}},[a("span",[t._v(t._s(t.cardData.end_time||"不限日期"))])])],1)],1),a("el-form-item",{attrs:{label:"状态："}},[a("el-tag",{attrs:{type:t.invalidMap[t.cardData.status].type,effect:"plain",size:"small"}},[t._v(" "+t._s(t.invalidMap[t.cardData.status].text)+" ")])],1)],1)],1):t._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"cs-fl"},[a("el-button",{attrs:{icon:"el-icon-printer",size:"small"},on:{click:function(e){return t.$refs.print.toPrint()}}},[t._v("打印")])],1),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.infoVisible=!1}}},[t._v("确定")])],1)],1)],1)},i=[],l=(a("4160"),a("c975"),a("d3b7"),a("159b"),a("5530")),r=a("ca00"),s=a("6f85"),o={components:{csPrint:function(){return a.e("chunk-2d238a43").then(a.bind(null,"fff3"))}},props:{loading:{default:!1},tableData:{default:function(){return[]}},cardData:{default:null}},data:function(){return{infoVisible:!1,currentTableData:[],multipleSelection:[],auth:{info:!1,enable:!1,disable:!1},activeMap:{0:{text:"待激活",type:"info"},1:{text:"已激活",type:""}},invalidMap:{0:{text:"禁用",type:"danger"},1:{text:"启用",type:"success"},2:{text:"...",type:"info"}}}},filters:{getNumber:function(t){return r["a"].getNumber(t)}},watch:{tableData:{handler:function(t){this.currentTableData=t},immediate:!0}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.info=this.$permission("/marketing/card/use/info"),this.auth.enable=this.$permission("/marketing/card/use/enable"),this.auth.disable=this.$permission("/marketing/card/use/disable")},_getIdList:function(t){null===t&&(t=this.multipleSelection);var e=[];return Array.isArray(t)?t.forEach((function(t){e.push(t.card_use_id)})):e.push(this.currentTableData[t].card_use_id),e},handleSelectionChange:function(t){this.multipleSelection=t},handleInfo:function(){this.cardData?this.infoVisible=!0:this.$message.info("查询全部购物卡时无法显示信息")},handleInvalid:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._getIdList(t);if(0!==i.length){if(!n){var r=this.currentTableData[t];if(a=r.is_invalid?0:1,r.is_invalid>1)return;if(0===a&&!this.auth.disable)return;if(1===a&&!this.auth.enable)return}var o="请填写状态设置原因(备注)";this.$prompt(o,"状态设置",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:o}).then((function(l){var r=l.value;n||e.$set(e.currentTableData[t],"is_invalid",2),c(i,a,r,e)})).catch((function(){}))}else this.$message.error("请选择要操作的数据");function c(t,e,a,n){Object(s["c"])({card_use_id:t,is_invalid:e,remark:a}).then((function(){n.currentTableData.forEach((function(i,r){-1!==t.indexOf(i.card_use_id)&&n.$set(n.currentTableData,r,Object(l["a"])(Object(l["a"])({},i),{},{is_invalid:e,remark:a}))})),n.$message.success("操作成功")}))}}}},c=o,u=a("2877"),d=Object(u["a"])(c,n,i,!1,null,null,null);e["default"]=d.exports}}]);